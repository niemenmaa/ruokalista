<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Ruokalista{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <style>
        :root {
            --pico-font-family: 'Segoe UI', system-ui, sans-serif;
            --primary: #e07a5f;
            --primary-hover: #c4613f;
        }
        
        body {
            padding-bottom: 80px;
        }
        
        /* Navigation */
        nav.bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--pico-card-background-color);
            border-top: 1px solid var(--pico-muted-border-color);
            padding: 0.5rem;
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }
        
        nav.bottom-nav a {
            text-decoration: none;
            text-align: center;
            font-size: 0.75rem;
            color: var(--pico-muted-color);
            padding: 0.25rem 0.5rem;
        }
        
        nav.bottom-nav a.active {
            color: var(--primary);
        }
        
        nav.bottom-nav .nav-icon {
            font-size: 1.5rem;
            display: block;
        }
        
        /* Header */
        header.top-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            margin: -1rem -1rem 1rem -1rem;
        }
        
        header.top-header h1 {
            margin: 0;
            font-size: 1.25rem;
        }
        
        /* Cards */
        .meal-card {
            background: var(--pico-card-background-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
            color: inherit;
            border: 1px solid var(--pico-muted-border-color);
        }
        
        .meal-card:hover {
            border-color: var(--primary);
        }
        
        .meal-card.done {
            opacity: 0.5;
            text-decoration: line-through;
        }
        
        .meal-card .toggle {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--pico-muted-color);
        }
        
        .meal-card .toggle.done {
            color: var(--primary);
        }
        
        .meal-card .title {
            flex: 1;
            font-weight: 500;
        }
        
        /* Day sections */
        .day-section {
            margin-bottom: 1.5rem;
        }
        
        .day-section h3 {
            font-size: 0.875rem;
            color: var(--pico-muted-color);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid var(--pico-muted-border-color);
            padding-bottom: 0.25rem;
        }
        
        .day-section.today h3 {
            color: var(--primary);
            border-color: var(--primary);
        }
        
        .day-section .empty {
            color: var(--pico-muted-color);
            font-style: italic;
            font-size: 0.875rem;
        }
        
        /* Recipe view */
        .recipe-section {
            margin-bottom: 2rem;
        }

        .recipe-section h2 {
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
        }

        .ingredients-header {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .ingredients-list {
            list-style: none;
            padding: 0;
            margin-bottom: 2rem;
        }

        .ingredients-list li {
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--pico-muted-border-color);
            display: flex;
            justify-content: space-between;
            align-items: baseline;
        }

        .ingredients-list li:last-child {
            border-bottom: none;
        }

        .ingredients-list .amount {
            color: var(--pico-muted-color);
            white-space: nowrap;
            margin-left: 1rem;
        }

        /* Phases / steps */
        .phases-header {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .phase-list {
            list-style: none;
            padding: 0;
            counter-reset: step-counter;
        }

        .phase-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: flex-start;
        }

        .phase-number {
            width: 32px;
            height: 32px;
            min-width: 32px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            margin-top: 2px;
        }

        .phase-content {
            flex: 1;
        }

        .phase-description {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 0.25rem;
        }

        .phase-time {
            display: inline-block;
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 500;
            margin-top: 0.25rem;
        }

        .phase-ingredients-list {
            list-style: none;
            padding: 0;
            margin-top: 0.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .phase-ingredients-list li {
            background: #fdf0ec;
            color: #7a3e2d;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            font-size: 0.8rem;
            white-space: nowrap;
        }
        
        /* Recipe list */
        .recipe-list {
            list-style: none;
            padding: 0;
        }
        
        .recipe-list li {
            border-bottom: 1px solid var(--pico-muted-border-color);
        }
        
        .recipe-list a {
            display: block;
            padding: 1rem 0;
            text-decoration: none;
        }
        
        /* Forms */
        .form-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .form-row input, .form-row select {
            margin-bottom: 0;
        }

        /* Meal rows for week setup */
        .meal-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .meal-row select {
            margin-bottom: 0;
        }

        .meal-row .recipe-select {
            flex: 2;
            min-width: 150px;
        }

        .meal-row .date-select,
        .meal-row .chef-select {
            flex: 1;
            min-width: 100px;
        }

        .meal-row.empty {
            opacity: 0.7;
        }

        .meal-row button.small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Meal info in week view */
        .meal-info {
            flex: 1;
        }

        .meal-meta {
            font-size: 0.8rem;
            color: var(--pico-muted-color);
            margin-top: 0.25rem;
        }

        .meal-meta .date {
            margin-right: 0.5rem;
        }

        .meal-meta .muted {
            font-style: italic;
        }

        .meal-meta .chef {
            background: var(--pico-secondary-background);
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .meal-card.today {
            border-color: var(--primary);
            border-width: 2px;
        }

        /* Template meals */
        .template-meals .meal-row {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--pico-muted-border-color);
        }

        .template-meals .recipe-name {
            flex: 1;
        }
        
        /* Editor */
        textarea.editor {
            font-family: monospace;
            min-height: 400px;
        }

        .editor-section {
            border: 1px solid var(--pico-muted-border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .editor-section h4 {
            font-size: 0.9rem;
            margin: 0.75rem 0 0.25rem;
        }

        .section-header {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .section-header input {
            margin-bottom: 0;
            font-weight: 600;
        }

        .ingredient-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }

        .ingredient-row .ing-name {
            flex: 2;
        }

        .ingredient-row .ing-amount,
        .ingredient-row .ing-unit {
            flex: 1;
        }

        .ingredient-row input,
        .phase-row input {
            margin-bottom: 0;
        }

        .phase-row {
            border: 1px solid var(--pico-muted-border-color);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .phase-header {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .phase-header input {
            flex: 1;
        }

        .phase-ingredients {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem 1rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }

        .phase-ing-check {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 0;
        }

        .phase-ing-check input[type="checkbox"] {
            margin: 0;
        }

        .remove-btn {
            background: none;
            border: 1px solid #dc3545;
            color: #dc3545;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1rem;
            line-height: 1;
            padding: 0.25rem 0.5rem;
            flex-shrink: 0;
        }

        .remove-btn:hover {
            background: #dc3545;
            color: white;
        }

        .small-btn {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
        }
        
        /* Flash messages */
        .flash {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .flash.success {
            background: #d4edda;
            color: #155724;
        }
        
        .flash.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Buttons */
        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        /* Sync status */
        .sync-status {
            padding: 1rem;
            background: var(--pico-card-background-color);
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .sync-status.has-changes {
            border-left: 4px solid var(--primary);
        }
        
        .file-list {
            font-family: monospace;
            font-size: 0.875rem;
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: var(--pico-code-background-color);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <main class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </main>
    
    <nav class="bottom-nav">
        <a href="{{ url_for('index') }}" class="{{ 'active' if request.endpoint == 'index' else '' }}">
            <span class="nav-icon">ðŸ“…</span>
            Viikko
        </a>
        <a href="{{ url_for('weeks') }}" class="{{ 'active' if request.endpoint == 'weeks' else '' }}">
            <span class="nav-icon">ðŸ“†</span>
            Viikot
        </a>
        <a href="{{ url_for('recipes') }}" class="{{ 'active' if request.endpoint in ['recipes', 'recipe', 'edit_recipe'] else '' }}">
            <span class="nav-icon">ðŸ“–</span>
            Reseptit
        </a>
        <a href="{{ url_for('templates') }}" class="{{ 'active' if request.endpoint in ['templates', 'template_detail'] else '' }}">
            <span class="nav-icon">ðŸ“‹</span>
            Pohjat
        </a>
        <a href="{{ url_for('shopping') }}" class="{{ 'active' if request.endpoint == 'shopping' else '' }}">
            <span class="nav-icon">ðŸ›’</span>
            Ostokset
        </a>
    </nav>
</body>
</html>
